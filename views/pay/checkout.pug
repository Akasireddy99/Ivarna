extends ../layout

block head-pack
	script#bolt(src='https://sboxcheckout-static.citruspay.com/bolt/run/bolt.min.js', bolt-='', color='e34524', bolt-logo='http://boltiswatching.com/wp-content/uploads/2015/09/Bolt-Logo-e14421724859591.png')
		
	style(type='text/css').
		.main {
		margin-left: 30px;
		font-family: Verdana, Geneva, sans-serif, serif;
		}
		.text {
		float: left;
		width: 180px;
		}
		.dv {
		margin-bottom: 5px;
		}

block body-pack

	br
	br
	br
	br

	.container.bg-light
		.row
			.col-md-8
				h3.mb-3 Billing
				form.needs-validation
					.row
						.col-md-6
							label(for="firstName") First Name
							input.form-control(type="text" name="firstName")
						.col-md-6
							label(for="lastName") Last Name
							input.form-control(type="text" name="lastName")
					.mb-3
						label(for="email") Email
						input.form-control(type="email" name="email")
			.col-md-4


	.main
		h2 Node.js Bolt
		
		form(action="#" id="payment_form")
			input(type="hidden" id="udf5" name="udf5" value="BOLT_KIT_NODE_JS")
			input(type="hidden" id="surl" name="surl" value="http://localhost:3000/pay/response")

			.dv
				span.text
					label Merchant Key:

				span
					input(type="button" value="dIiWmbAn" id="key" name="key" placeholder="Merchant Key")
						
				
			.dv
				span.text
					label Merchant Salt:
				span
					input#salt(type='text', name='salt', placeholder='Merchant Salt', value='E3LeC89b59')
	
			.dv
				span.text
					label Transaction/Order ID:
				span
					input#txnid(type='text', name='txnid', placeholder='Transaction ID', value=orderid)
			
			.dv
				span.text
					label Amount:
				span
					input#amount(type='text', name='amount', placeholder='Amount', value='6.00')
			
			.dv
				span.text
					label Product Info:
				span
					input#pinfo(type='text', name='pinfo', placeholder='Product Info', value='P01,P02')
			
			.dv
				span.text
					label First Name:
				span
					input#fname(type='text', name='fname', placeholder='First Name', value='')
			
			.dv
				span.text
					label Email ID:
				span
					input#email(type='text', name='email', placeholder='Email ID', value='')
			
			.dv
				span.text
					label Mobile/Cell Number:
				span
					input#mobile(type='text', name='mobile', placeholder='Mobile/Cell Number', value='')
			
			.dv
				span.text
					label Hash:
				span
					input#hash(type='text', name='hash', placeholder='Hash', value='')
			
			#alertinfo.dv
			div
				input(type='submit', value='Pay', onclick='launchBOLT(); return false;')
		
		
	script(type='text/javascript').
		$('#payment_form').bind('keyup blur', function () {
			$.ajax({
				url: 'http://localhost:3000/pay',
				type: 'post',
				data: JSON.stringify({
					key: $('#key').val(),
					salt: $('#salt').val(),
					txnid: $('#txnid').val(),
					amount: $('#amount').val(),
					pinfo: $('#pinfo').val(),
					fname: $('#fname').val(),
					email: $('#email').val(),
					mobile: $('#mobile').val(),
					udf5: $('#udf5').val()
				}),
				contentType: "application/json",
				dataType: 'json',
				success: function (json) {
					$('#hash').val(json);
				}
			});
		});
	script(type='text/javascript').
		function launchBOLT() {
			bolt.launch({
				key: $('#key').val(),
				txnid: $('#txnid').val(),
				hash: $('#hash').val(),
				amount: $('#amount').val(),
				firstname: $('#fname').val(),
				email: $('#email').val(),
				phone: $('#mobile').val(), 
				productinfo: $('#pinfo').val(),
				udf5: $('#udf5').val(),
				surl: $('#surl').val(),
				furl: $('#surl').val()
				}, {
				responseHandler: function (BOLT) {
					console.log(BOLT.response.txnStatus);
					if (BOLT.response.txnStatus != 'CANCEL') {
						window.location.replace("")
						//Salt is passd here for demo purpose only. For practical use keep salt at server side only.
						var fr = '<form action=\\"' + $('#surl').val() + '\" method=\"post\">' +
						'<input type=\\"hidden\" name=\"key\" value=\"' + BOLT.response.key + '\" />' +
						'<input type=\\"hidden\" name=\"salt\" value=\"' + $('#salt').val() + '\" />' +
						'<input type=\\"hidden\" name=\"txnid\" value=\"' + BOLT.response.txnid + '\" />' +
						'<input type=\\"hidden\" name=\"amount\" value=\"' + BOLT.response.amount + '\" />' +
						'<input type=\\"hidden\" name=\"productinfo\" value=\"' + BOLT.response.productinfo + '\" />' +
						'<input type=\\"hidden\" name=\"firstname\" value=\"' + BOLT.response.firstname + '\" />' +
						'<input type=\\"hidden\" name=\"email\" value=\"' + BOLT.response.email + '\" />' +
						'<input type=\\"hidden\" name=\"udf5\" value=\"' + BOLT.response.udf5 + '\" />' +
						'<input type=\\"hidden\" name=\"mihpayid\" value=\"' + BOLT.response.mihpayid + '\" />' +
						'<input type=\\"hidden\" name=\"status\" value=\"' + BOLT.response.status + '\" />' +
						'<input type=\\"hidden\" name=\"hash\" value=\"' + BOLT.response.hash + '\" />' +
						'</form>';
						var form = jQuery(fr);
						jQuery('body').append(form);
						form.submit();
					}
				},
				catchException: function (BOLT) {
					alert(BOLT.message);
				}
			});
		}